<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>FC Jugadores — Gestión</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a; --panel: #111827; --text: #e5e7eb; --muted: #94a3b8;
      --accent: #38bdf8; --card: #1f2937; --border: #334155; --danger: #ef4444; --success: #34d399;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif; background: var(--bg); color: var(--text); }
    header { padding: 16px 24px; background: var(--panel); border-bottom: 1px solid var(--border); display:flex;justify-content:space-between;align-items:center; }
    main { max-width: 1200px; margin: 24px auto; padding: 0 16px; display:grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    section { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
    h2 { margin: 0 0 12px; font-size: 18px; color: var(--muted); }
    form { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    label { font-size: 12px; color: var(--muted); }
    input, select { width: 100%; padding: 8px; border-radius: 8px; border: 1px solid var(--border); background: #0b1224; color: var(--text); }
    .full { grid-column: 1 / -1; }
    .actions { display:flex; gap:8px; margin-top: 8px; }
    button { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .primary { background: var(--accent); color: #031a26; }
    .danger { background: var(--danger); color: #170000; }
    .success { background: var(--success); color: #00170b; }
    table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    th, td { padding: 8px; border-bottom: 1px solid var(--border); text-align: left; }
    thead th { color: var(--muted); font-weight: 600; }
    tbody tr:hover { background: #111b2f; }
    .toolbar { display:flex; gap:8px; margin-bottom: 8px; }
    .small { font-size: 12px; }
    .grid-3 { display:grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header>
    <h1>FC Jugadores — Gestión</h1>
    <div class="toolbar">
      <button id="refreshBtn" class="primary">Actualizar lista</button>
      <span id="status" class="small"></span>
    </div>
  </header>

  <main>
    <!-- Búsqueda -->
    <section>
      <h2>Búsqueda y filtros</h2>
      <form id="searchForm">
        <div>
          <label>Nombre</label>
          <input type="text" name="nombre" placeholder="Ej. Juan" />
        </div>
        <div>
          <label>ID</label>
          <input type="number" name="id" />
        </div>
        <div>
          <label>Estado</label>
          <select name="estado">
            <option value="">(todos)</option>
            <option value="activo">activo</option>
            <option value="suspendido">suspendido</option>
          </select>
        </div>
        <div>
          <label>Nacionalidad</label>
          <input type="text" name="nacionalidad" placeholder="Ej. CO" />
        </div>
        <div>
          <label>Edad</label>
          <input type="number" name="edad" />
        </div>
        <div>
          <label>Peso (kg)</label>
          <input type="number" step="0.01" name="peso_kg" />
        </div>
        <div>
          <label>Altura (cm)</label>
          <input type="number" step="0.01" name="altura_cm" />
        </div>
        <div>
          <label>Partidos</label>
          <input type="number" name="partidos_jugados" />
        </div>
        <div>
          <label>Goles anotados</label>
          <input type="number" name="goles_anotados" />
        </div>
        <div>
          <label>Goles recibidos</label>
          <input type="number" name="goles_recibidos" />
        </div>
        <div>
          <label>Tarjetas amarillas</label>
          <input type="number" name="tarjetas_amarillas" />
        </div>
        <div>
          <label>Tarjetas rojas</label>
          <input type="number" name="tarjetas_rojas" />
        </div>
        <div class="full actions">
          <button type="submit" class="primary">Buscar</button>
          <button type="reset">Limpiar</button>
        </div>
      </form>
    </section>

    <section>
      <h2>Crear jugador</h2>
      <form id="createForm">
        <div>
          <label>Nombre</label>
          <input name="nombre" required />
        </div>
        <div>
          <label>Número camiseta</label>
          <input type="number" name="numero_camiseta" required />
        </div>
        <div>
          <label>Fecha nacimiento</label>
          <input type="date" name="fecha_nacimiento" />
        </div>
        <div>
          <label>Edad</label>
          <input type="number" name="edad" />
        </div>
        <div>
          <label>Nacionalidad</label>
          <input name="nacionalidad" />
        </div>
        <div>
          <label>Estado</label>
          <select name="estado">
            <option value="activo">activo</option>
            <option value="suspendido">suspendido</option>
          </select>
        </div>
        <div>
          <label>Peso (kg)</label>
          <input type="number" step="0.01" name="peso_kg" />
        </div>
        <div>
          <label>Altura (cm)</label>
          <input type="number" step="0.01" name="altura_cm" />
        </div>
        <div>
          <label>Foto URL</label>
          <input name="foto_url" placeholder="https://..." />
        </div>
        <div>
          <label>Partidos</label>
          <input type="number" name="partidos_jugados" value="0" />
        </div>
        <div>
          <label>Goles anotados</label>
          <input type="number" name="goles_anotados" value="0" />
        </div>
        <div>
          <label>Goles recibidos</label>
          <input type="number" name="goles_recibidos" value="0" />
        </div>
        <div>
          <label>Tarjetas amarillas</label>
          <input type="number" name="tarjetas_amarillas" value="0" />
        </div>
        <div>
          <label>Tarjetas rojas</label>
          <input type="number" name="tarjetas_rojas" value="0" />
        </div>
        <div class="full actions">
          <button type="submit" class="success">Crear</button>
        </div>
      </form>
    </section>

    <section class="full" style="grid-column: 1 / -1;">
      <h2>Jugadores</h2>
      <div class="toolbar">
        <input id="quickSearch" placeholder="Búsqueda rápida por nombre..." />
        <button id="loadAll" class="primary">Cargar todos</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>ID</th><th>Nombre</th><th>#</th><th>Edad</th><th>Nacionalidad</th>
            <th>Estado</th><th>Partidos</th><th>GA</th><th>GR</th><th>TA</th><th>TR</th><th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </section>

    <section class="full" style="grid-column: 1 / -1;">
      <h2>Editar jugador</h2>
      <form id="editForm">
        <div class="grid-3">
          <div>
            <label>ID (solo lectura)</label>
            <input name="id" readonly />
          </div>
          <div>
            <label>Nombre</label>
            <input name="nombre" />
          </div>
          <div>
            <label>Número camiseta</label>
            <input type="number" name="numero_camiseta" />
          </div>
        </div>
        <div class="grid-3">
          <div>
            <label>Fecha nacimiento</label>
            <input type="date" name="fecha_nacimiento" />
          </div>
          <div>
            <label>Edad</label>
            <input type="number" name="edad" />
          </div>
          <div>
            <label>Nacionalidad</label>
            <input name="nacionalidad" />
          </div>
        </div>
        <div class="grid-3">
          <div>
            <label>Estado</label>
            <select name="estado">
              <option value="">(no cambiar)</option>
              <option value="activo">activo</option>
              <option value="suspendido">suspendido</option>
            </select>
          </div>
          <div>
            <label>Peso (kg)</label>
            <input type="number" step="0.01" name="peso_kg" />
          </div>
          <div>
            <label>Altura (cm)</label>
            <input type="number" step="0.01" name="altura_cm" />
          </div>
        </div>
        <div class="grid-3">
          <div>
            <label>Foto URL</label>
            <input name="foto_url" />
          </div>
          <div>
            <label>Partidos</label>
            <input type="number" name="partidos_jugados" />
          </div>
          <div>
            <label>Goles anotados</label>
            <input type="number" name="goles_anotados" />
          </div>
        </div>
        <div class="grid-3">
          <div>
            <label>Goles recibidos</label>
            <input type="number" name="goles_recibidos" />
          </div>
          <div>
            <label>Tarjetas amarillas</label>
            <input type="number" name="tarjetas_amarillas" />
          </div>
          <div>
            <label>Tarjetas rojas</label>
            <input type="number" name="tarjetas_rojas" />
          </div>
        </div>
        <div class="actions">
          <button type="submit" class="primary">Guardar cambios</button>
          <button type="button" id="cancelEdit">Cancelar</button>
        </div>
      </form>
    </section>
  </main>

  <script>
    const api = {
      list: () => fetch("/jugadores/").then(r => r.json()),
      listDeleted: () => fetch("/jugadores/eliminados/").then(r => r.json()),
      create: (payload) => fetch("/jugadores/crear/", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) }).then(r => r.json()),
      update: (id, payload) => fetch(`/jugadores/editar/${id}`, { method: "PATCH", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) }).then(async r => { if (!r.ok) throw new Error(await r.text()); return r.json(); }),
      delete: (id) => fetch(`/jugadores/eliminar/${id}`, { method: "DELETE" }).then(async r => { if (!r.ok) throw new Error(await r.text()); return r.json(); }),
      restore: (id) => fetch(`/jugadores/restaurar/${id}`, { method: "POST" }).then(async r => { if (!r.ok) throw new Error(await r.text()); return r.json(); }),
      search: (params) => fetch(`/jugadores/buscar/?${new URLSearchParams(params)}`).then(r => r.json())
    };

    const tbody = document.getElementById("tbody");
    const statusEl = document.getElementById("status");
    const refreshBtn = document.getElementById("refreshBtn");
    const quickSearch = document.getElementById("quickSearch");
    const loadAllBtn = document.getElementById("loadAll");
    const createForm = document.getElementById("createForm");
    const editForm = document.getElementById("editForm");
    const cancelEditBtn = document.getElementById("cancelEdit");
    const searchForm = document.getElementById("searchForm");

    let currentData = [];
    let editingId = null;

    function setStatus(text, ok = true) {
      statusEl.textContent = text;
      statusEl.style.color = ok ? "#34d399" : "#ef4444";
      if (text) setTimeout(() => statusEl.textContent = "", 4000);
    }

    function renderRows(rows) {
      tbody.innerHTML = "";
      rows.forEach(j => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${j.id}</td>
          <td>${j.nombre}</td>
          <td>${j.numero_camiseta ?? ""}</td>
          <td>${j.edad ?? ""}</td>
          <td>${j.nacionalidad ?? ""}</td>
          <td>${j.estado}</td>
          <td>${j.partidos_jugados}</td>
          <td>${j.goles_anotados}</td>
          <td>${j.goles_recibidos}</td>
          <td>${j.tarjetas_amarillas}</td>
          <td>${j.tarjetas_rojas}</td>
          <td>
            <button class="primary small" data-action="edit" data-id="${j.id}">Editar</button>
            <button class="danger small" data-action="delete" data-id="${j.id}">Eliminar</button>
            <button class="small" data-action="restore" data-id="${j.id}">Restaurar</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function loadAll() {
      const data = await api.list();
      currentData = data;
      renderRows(data);
      setStatus(`Cargados ${data.length} jugadores`);
    }

    refreshBtn.addEventListener("click", loadAll);
    loadAllBtn.addEventListener("click", loadAll);

    tbody.addEventListener("click", async (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;
      const id = btn.dataset.id;
      const action = btn.dataset.action;

      if (action === "edit") {
        const j = currentData.find(x => x.id == id);
        if (!j) return setStatus("Jugador no encontrado", false);
        editingId = j.id;
        ["id","nombre","numero_camiseta","fecha_nacimiento","edad","nacionalidad","estado","peso_kg","altura_cm","foto_url","partidos_jugados","goles_anotados","goles_recibidos","tarjetas_amarillas","tarjetas_rojas"].forEach(k => {
          const el = editForm.elements[k];
          if (!el) return;
          el.value = j[k] ?? "";
        });
        window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
      }

      if (action === "delete") {
        try {
          await api.delete(id);
          setStatus(`Eliminado ID ${id}`);
          await loadAll();
        } catch (err) {
          setStatus(`Error al eliminar: ${err}`, false);
        }
      }

      if (action === "restore") {
        try {
          await api.restore(id);
          setStatus(`Restaurado ID ${id}`);
          await loadAll();
        } catch (err) {
          setStatus(`Error al restaurar: ${err}`, false);
        }
      }
    });

    quickSearch.addEventListener("input", (e) => {
      const q = e.target.value.toLowerCase();
      const filtered = currentData.filter(j => (j.nombre || "").toLowerCase().includes(q));
      renderRows(filtered);
    });

    searchForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fd = new FormData(searchForm);
      const params = {};
      for (const [k,v] of fd.entries()) {
        if (v !== "") params[k] = v;
      }
      const res = await api.search(params);
      currentData = res;
      renderRows(res);
      setStatus(`Encontrados ${res.length} jugadores`);
    });

    createForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fd = new FormData(createForm);
      const payload = {};
      for (const [k,v] of fd.entries()) {
 
        if (["numero_camiseta","edad","partidos_jugados","goles_anotados","goles_recibidos","tarjetas_amarillas","tarjetas_rojas"].includes(k)) {
          payload[k] = v === "" ? null : Number(v);
        } else if (["peso_kg","altura_cm"].includes(k)) {
          payload[k] = v === "" ? null : Number(v);
        } else {
          payload[k] = v === "" ? null : v;
        }
      }
      try {
        await api.create(payload);
        createForm.reset();
        setStatus("Jugador creado");
        await loadAll();
      } catch (err) {
        setStatus(`Error al crear: ${err}`, false);
      }
    });

    editForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!editingId) return setStatus("Selecciona un jugador para editar", false);
      const fd = new FormData(editForm);
      const payload = {};
      for (const [k,v] of fd.entries()) {
        if (k === "id") continue;
        if (v === "" || v === null) continue; 
        if (["numero_camiseta","edad","partidos_jugados","goles_anotados","goles_recibidos","tarjetas_amarillas","tarjetas_rojas"].includes(k)) {
          payload[k] = Number(v);
        } else if (["peso_kg","altura_cm"].includes(k)) {
          payload[k] = Number(v);
        } else {
          payload[k] = v;
        }
      }
      try {
        await api.update(editingId, payload);
        setStatus("Cambios guardados");
        editingId = null;
        editForm.reset();
        await loadAll();
      } catch (err) {
        setStatus(`Error al editar: ${err}`, false);
      }
    });

    cancelEditBtn.addEventListener("click", () => {
      editingId = null;
      editForm.reset();
      setStatus("Edición cancelada");
    });

    loadAll();
  </script>
</body>
</html>
